<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deafbakery 組織圖</title>
  <!-- 引入 Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入 React 和 ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- 引入 Babel 用於解析 JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* 自定義動畫 */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out forwards;
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-scaleIn {
      animation: scaleIn 0.2s ease-out forwards;
    }
  </style>
</head>
<body class="bg-orange-50 text-stone-800 font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // --- 圖示組件 (SVG) ---
    const Icon = ({ name, size = 24, className = "" }) => {
      const icons = {
        Users: <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>,
        User: <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>,
        Lock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
        Unlock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></>,
        Edit: <><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></>,
        Save: <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>,
        Plus: <><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>,
        Trash2: <><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>,
        ChevronDown: <polyline points="6 9 12 15 18 9"/>,
        ChevronRight: <polyline points="9 18 15 12 9 6"/>,
        ChevronUp: <polyline points="18 15 12 9 6 15"/>,
        Copy: <><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></>,
        ZoomIn: <><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></>,
        ZoomOut: <><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></>,
        Maximize: <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>,
        LayoutList: <><rect x="3" y="14" width="7" height="7"/><rect x="3" y="3" width="7" height="7"/><line x1="14" y1="4" x2="21" y2="4"/><line x1="14" y1="9" x2="21" y2="9"/><line x1="14" y1="15" x2="21" y2="15"/><line x1="14" y1="20" x2="21" y2="20"/></>,
        Network: <><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><rect x="9" y="2" width="6" height="6" rx="1"/><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"/><path d="M12 12V8"/></>,
        LogIn: <><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></>,
        LogOut: <><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>
      };

      return (
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          width={size} 
          height={size} 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round" 
          className={className}
        >
          {icons[name] || <circle cx="12" cy="12" r="10"/>}
        </svg>
      );
    };

    // --- 初始資料 ---
    const INITIAL_DATA = [
      { id: "CEO", name: "潘信宏", title: "", managementTitle: "執行長", parentId: "" },
      { id: "COO", name: "潘重恩", title: "", managementTitle: "營運長", parentId: "CEO" },
      { id: "C_PROD", name: "生產中心", title: "", managementTitle: "", parentId: "COO" },
      { id: "C_LOGI", name: "物流中心", title: "", managementTitle: "", parentId: "COO" },
      { id: "C_OPS", name: "營運中心", title: "", managementTitle: "", parentId: "COO" },
      { id: "C_MGM", name: "管理中心", title: "", managementTitle: "", parentId: "COO" },
      { id: "D_PROD", name: "生產部", title: "", managementTitle: "", parentId: "羅月惠" },
      { id: "D_PKG", name: "包裝部", title: "", managementTitle: "", parentId: "C_PROD" },
      { id: "D_SHIP", name: "出貨部", title: "", managementTitle: "", parentId: "C_LOGI" },
      { id: "D_LOGI", name: "物流部", title: "", managementTitle: "", parentId: "C_LOGI" },
      { id: "D_MKT", name: "行銷部", title: "", managementTitle: "", parentId: "C_OPS" },
      { id: "D_SALES", name: "銷售部", title: "", managementTitle: "", parentId: "C_OPS" },
      { id: "D_CS", name: "客服部", title: "", managementTitle: "", parentId: "C_OPS" },
      { id: "D_BD", name: "商務拓展部", title: "", managementTitle: "", parentId: "C_OPS" },
      { id: "D_ADMIN", name: "管理部", title: "", managementTitle: "", parentId: "C_MGM" },
      { id: "D_RD", name: "研發部", title: "", managementTitle: "", parentId: "C_PROD" },
      { id: "G_PM", name: "專案管理組", title: "", managementTitle: "", parentId: "邱夢涵" },
      { id: "G_ART", name: "美編組", title: "", managementTitle: "", parentId: "邱夢涵" },
      { id: "G_SNS", name: "社群組", title: "", managementTitle: "", parentId: "邱夢涵" },
      { id: "G_PLAN", name: "企劃組", title: "", managementTitle: "", parentId: "邱夢涵" },
      { id: "G_HR", name: "人力資源組", title: "", managementTitle: "", parentId: "D_ADMIN" },
      { id: "G_GA", name: "總務行政組", title: "", managementTitle: "", parentId: "D_ADMIN" },
      { id: "G_FIN", name: "財務組", title: "", managementTitle: "", parentId: "D_ADMIN" },
      { id: "G_IT", name: "資訊管理組", title: "", managementTitle: "", parentId: "D_ADMIN" },
      { id: "G_FILL", name: "餡料組", title: "", managementTitle: "", parentId: "D_PROD" },
      { id: "G_CUT", name: "切割組", title: "", managementTitle: "", parentId: "D_PROD" },
      { id: "G_BAKE", name: "烘烤組", title: "", managementTitle: "", parentId: "D_PROD" },
      { id: "羅月惠", name: "羅月惠", title: "", managementTitle: "總監", parentId: "C_PROD" },
      { id: "吳夢婷", name: "吳夢婷", title: "", managementTitle: "經理", parentId: "D_BD" },
      { id: "陳巧珊", name: "陳巧珊", title: "業務專員", managementTitle: "", parentId: "吳夢婷" },
      { id: "邱宗仁", name: "邱宗仁", title: "物流專員", managementTitle: "襄理", parentId: "D_LOGI" },
      { id: "謝呈弦", name: "謝呈弦", title: "物流專員", managementTitle: "", parentId: "邱宗仁" },
      { id: "李建興", name: "李建興", title: "物流專員", managementTitle: "", parentId: "邱宗仁" },
      { id: "賴韋仲", name: "賴韋仲", title: "理貨專員", managementTitle: "襄理", parentId: "D_SHIP" },
      { id: "莊于揮", name: "莊于揮", title: "理貨專員", managementTitle: "", parentId: "賴韋仲" },
      { id: "羅虹旻", name: "羅虹旻", title: "理貨專員", managementTitle: "組長", parentId: "賴韋仲" },
      { id: "王惠琦", name: "王惠琦", title: "理貨專員", managementTitle: "組長", parentId: "賴韋仲" },
      { id: "賴瑞池", name: "賴瑞池", title: "理貨專員", managementTitle: "", parentId: "賴韋仲" },
      { id: "張熒倫", name: "張熒倫", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "林淑琪", name: "林淑琪", title: "理貨專員", managementTitle: "", parentId: "賴韋仲" },
      { id: "陳玟婕", name: "陳玟婕", title: "理貨專員", managementTitle: "", parentId: "賴韋仲" },
      { id: "藍卿碧", name: "藍卿碧", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "陳川倪", name: "陳川倪", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "羅冠琳", name: "羅冠琳", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "謝秀卿", name: "謝秀卿", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "張沛嫺", name: "張沛嫺", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "陳美余", name: "陳美余", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "林美晴", name: "林美晴", title: "理貨員", managementTitle: "", parentId: "賴韋仲" },
      { id: "徐珮庭", name: "徐珮庭", title: "銷售專員", managementTitle: "儲備幹部", parentId: "顧庭瑋" },
      { id: "許雅惠", name: "許雅惠", title: "銷售人員", managementTitle: "", parentId: "徐珮庭" },
      { id: "潘名貞", name: "潘名貞", title: "銷售人員", managementTitle: "", parentId: "徐珮庭" },
      { id: "蕭羽婷", name: "蕭羽婷", title: "銷售人員", managementTitle: "", parentId: "徐珮庭" },
      { id: "黃惠玲", name: "黃惠玲", title: "包裝專員", managementTitle: "襄理", parentId: "D_PKG" },
      { id: "譚文琦", name: "譚文琦", title: "包裝專員", managementTitle: "組長", parentId: "黃惠玲" },
      { id: "盧怡安", name: "盧怡安", title: "包裝專員", managementTitle: "組長", parentId: "黃惠玲" },
      { id: "王若蓁", name: "王若蓁", title: "包裝專員", managementTitle: "組長", parentId: "黃惠玲" },
      { id: "賴羽珊", name: "賴羽珊", title: "包裝專員", managementTitle: "", parentId: "黃惠玲" },
      { id: "李美玲", name: "李美玲", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "蔡雅姍", name: "蔡雅姍", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "游雅雯", name: "游雅雯", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "何如雁", name: "何如雁", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "賴宜貞", name: "賴宜貞", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "李涔瑜", name: "李涔瑜", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "沈傳仁", name: "沈傳仁", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "林妍綸", name: "林妍綸", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "劉星岑", name: "劉星岑", title: "包裝員", managementTitle: "", parentId: "黃惠玲" },
      { id: "利偉銨", name: "利偉銨", title: "資深研發專員", managementTitle: "研發主廚", parentId: "D_RD" },
      { id: "卓佳蓉", name: "卓佳蓉", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "李怡珊", name: "李怡珊", title: "資深技術專員", managementTitle: "", parentId: "利偉銨" },
      { id: "蔡孟庭", name: "蔡孟庭", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "曹柏凱", name: "曹柏凱", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "洪孝誼", name: "洪孝誼", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "劉羿君", name: "劉羿君", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "陳浚宏", name: "陳浚宏", title: "技術專員", managementTitle: "廠務", parentId: "羅月惠" },
      { id: "鄭靜宜", name: "鄭靜宜", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "鍾騄震", name: "鍾騄震", title: "技術專員", managementTitle: "組長", parentId: "羅月惠" },
      { id: "汪建佑", name: "汪建佑", title: "技術專員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "柯泳安", name: "柯泳安", title: "技術專員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "葉文琳", name: "葉文琳", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "黃佳祺", name: "黃佳祺", title: "作業員", managementTitle: "食安管理人員", parentId: "卓佳蓉" },
      { id: "劉汴萱", name: "劉汴萱", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "吳柔漪", name: "吳柔漪", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "陳韻嵐", name: "陳韻嵐", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "李昕庭", name: "李昕庭", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "董俊佑", name: "董俊佑", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "汪建達", name: "汪建達", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "蔡詠翔", name: "蔡詠翔", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "葉柏志", name: "葉柏志", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "黃威智", name: "黃威智", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "林華萱", name: "林華萱", title: "作業員", managementTitle: "", parentId: "卓佳蓉" },
      { id: "蕭靖嬙", name: "蕭靖嬙", title: "美編專員", managementTitle: "組長", parentId: "G_ART" },
      { id: "邱夢涵", name: "邱夢涵", title: "資深專案執行", managementTitle: "經理", parentId: "D_MKT" },
      { id: "蘇羿瑄", name: "蘇羿瑄", title: "社群專員", managementTitle: "組長", parentId: "G_SNS" },
      { id: "蘇凌萱", name: "蘇凌萱", title: "專案執行專員", managementTitle: "", parentId: "G_PM" },
      { id: "張宜婷", name: "張宜婷", title: "專案執行專員", managementTitle: "", parentId: "G_PM" },
      { id: "洪千惟", name: "洪千惟", title: "美編專員", managementTitle: "", parentId: "蕭靖嬙" },
      { id: "林季嫻", name: "林季嫻", title: "專案執行專員", managementTitle: "", parentId: "G_PM" },
      { id: "許可榆", name: "許可榆", title: "社群小編", managementTitle: "", parentId: "蘇羿瑄" },
      { id: "陳楷曜", name: "陳楷曜", title: "社群小編", managementTitle: "", parentId: "蘇羿瑄" },
      { id: "曹櫻樺", name: "曹櫻樺", title: "專案執行專員", managementTitle: "", parentId: "G_PM" },
      { id: "徐苑妮", name: "徐苑妮", title: "會計人員", managementTitle: "", parentId: "G_FIN" },
      { id: "廖詩旻", name: "廖詩旻", title: "資深專員", managementTitle: "", parentId: "G_HR" },
      { id: "何芸芳", name: "何芸芳", title: "專員", managementTitle: "", parentId: "G_HR" },
      { id: "陳俊吉", name: "陳俊吉", title: "專員", managementTitle: "", parentId: "G_GA" },
      { id: "鄭鋆慈", name: "鄭鋆慈", title: "專員", managementTitle: "", parentId: "G_HR" },
      { id: "蔡臻妮", name: "蔡臻妮", title: "專員", managementTitle: "", parentId: "G_GA" },
      { id: "楊淨雯", name: "楊淨雯", title: "專員", managementTitle: "", parentId: "G_GA" },
      { id: "林喬昕", name: "林喬昕", title: "專員", managementTitle: "", parentId: "G_GA" },
      { id: "賴玉珠", name: "賴玉珠", title: "專員", managementTitle: "", parentId: "G_GA" },
      { id: "王佑珊", name: "王佑珊", title: "客服專員", managementTitle: "襄理", parentId: "D_CS" },
      { id: "潘卉雅", name: "潘卉雅", title: "客服專員", managementTitle: "", parentId: "王佑珊" },
      { id: "林姿穎", name: "林姿穎", title: "客服專員", managementTitle: "", parentId: "王佑珊" },
      { id: "邱慧姍", name: "邱慧姍", title: "客服專員", managementTitle: "", parentId: "王佑珊" },
      { id: "游昭琪", name: "游昭琪", title: "客服專員", managementTitle: "", parentId: "王佑珊" },
      { id: "顧庭瑋", name: "顧庭瑋", title: "", managementTitle: "兼任經理", parentId: "D_SALES" },
      { id: "潘全恩", name: "潘全恩", title: "", managementTitle: "資訊長", parentId: "G_IT" },
    ];

    // --- 輔助功能：建立樹狀結構 ---
    const buildTree = (items) => {
      const rootItems = [];
      const lookup = {};
      for (const item of items) {
        lookup[item.id] = { ...item, children: [] };
      }
      for (const item of items) {
        if (item.parentId && lookup[item.parentId]) {
          lookup[item.parentId].children.push(lookup[item.id]);
        } else {
          rootItems.push(lookup[item.id]);
        }
      }
      return rootItems;
    };

    // --- 元件：遞迴樹節點 (桌面版/手機圖表版 - 可點擊縮放) ---
    const TreeNode = ({ node }) => {
      const [expanded, setExpanded] = useState(true);
      
      const isOrgUnit = node.id.startsWith('C_') || node.id.startsWith('D_') || node.id.startsWith('G_');
      const hasChildren = node.children.length > 0;
      
      return (
        <div className="flex flex-col items-center mx-2">
          {/* 節點卡片 */}
          <div 
            onClick={() => hasChildren && setExpanded(!expanded)}
            className={`
              relative flex flex-col items-center justify-center p-3 mb-4 rounded-lg shadow-sm border transition-all hover:shadow-md
              ${hasChildren ? 'cursor-pointer hover:scale-105' : 'cursor-default'}
              ${isOrgUnit 
                ? 'bg-amber-100 border-amber-300 w-32 min-h-[60px]' 
                : 'bg-white border-stone-200 w-36 min-h-[80px]'}
            `}
          >
            <div className={`font-bold text-center ${isOrgUnit ? 'text-amber-900 text-lg' : 'text-stone-800 text-base'}`}>
              {node.name}
            </div>
            
            {!isOrgUnit && (
              <React.Fragment>
                {node.managementTitle && (
                  <div className="text-xs font-medium text-orange-600 mt-1 bg-orange-50 px-2 py-0.5 rounded-full">
                    {node.managementTitle}
                  </div>
                )}
                {node.title && (
                  <div className="text-xs text-stone-500 mt-1 text-center">
                    {node.title}
                  </div>
                )}
              </React.Fragment>
            )}

            {/* 展開/收合指示器 */}
            {hasChildren && (
              <div className="absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-5 h-5 bg-white border border-stone-300 rounded-full flex items-center justify-center text-stone-500 text-[10px] shadow-sm z-10">
                {expanded ? '-' : '+'}
              </div>
            )}
          </div>

          {/* 連接線與子節點 */}
          {hasChildren && expanded && (
            <div className="flex flex-col items-center animate-fadeIn">
              <div className="w-px h-4 bg-stone-300"></div>
              
              <div className="flex items-start">
                 {node.children.map((child, index) => (
                   <div key={child.id} className="flex flex-col items-center">
                     <div className="flex w-full">
                        <div className={`h-px bg-stone-300 w-[50%] ${index === 0 ? 'invisible' : ''}`}></div>
                        <div className={`h-px bg-stone-300 w-[50%] ${index === node.children.length - 1 ? 'invisible' : ''}`}></div>
                     </div>
                     <div className="w-px h-4 bg-stone-300"></div>
                     <TreeNode node={child} />
                   </div>
                 ))}
              </div>
            </div>
          )}
          
          {hasChildren && !expanded && (
             <div className="w-px h-2 bg-stone-300 opacity-50"></div>
          )}
        </div>
      );
    };

    // --- 元件：遞迴列表節點 (手機版 - 垂直) ---
    const MobileTreeNode = ({ node, level = 0 }) => {
      const [isOpen, setIsOpen] = useState(true); 
      const hasChildren = node.children.length > 0;
      const isOrgUnit = node.id.startsWith('C_') || node.id.startsWith('D_') || node.id.startsWith('G_');

      const paddingLeft = `${level * 16 + 12}px`;

      return (
        <div className="w-full">
          <div 
            className={`
              flex items-center p-3 border-b border-stone-100 transition-colors cursor-pointer active:bg-stone-50
              ${isOrgUnit ? 'bg-amber-50' : 'bg-white'}
            `}
            style={{ paddingLeft }}
            onClick={() => hasChildren && setIsOpen(!isOpen)}
          >
            <div className="mr-2 text-stone-400 w-5 flex justify-center">
              {hasChildren ? (
                isOpen ? <Icon name="ChevronDown" size={16} /> : <Icon name="ChevronRight" size={16} />
              ) : (
                <span className="w-4" />
              )}
            </div>

            <div className="flex-1">
              <div className="flex items-center gap-2">
                <span className={`font-bold ${isOrgUnit ? 'text-amber-900 text-lg' : 'text-stone-800'}`}>
                  {node.name}
                </span>
                {!isOrgUnit && node.managementTitle && (
                  <span className="text-xs text-orange-600 bg-orange-100 px-1.5 py-0.5 rounded border border-orange-200">
                    {node.managementTitle}
                  </span>
                )}
              </div>
              {!isOrgUnit && node.title && (
                <div className="text-xs text-stone-500 mt-0.5">{node.title}</div>
              )}
            </div>
          </div>

          {hasChildren && isOpen && (
            <div className="w-full animate-fadeIn">
              {node.children.map(child => (
                <MobileTreeNode key={child.id} node={child} level={level + 1} />
              ))}
            </div>
          )}
        </div>
      );
    };

    function App() {
      const [employees, setEmployees] = useState([]);
      const [isAdmin, setIsAdmin] = useState(false);
      const [password, setPassword] = useState("");
      const [showLogin, setShowLogin] = useState(false);
      
      const [zoom, setZoom] = useState(1);
      const [mobileViewMode, setMobileViewMode] = useState('list'); 

      const [editingId, setEditingId] = useState(null);
      const [editForm, setEditForm] = useState({});

      useEffect(() => {
        const saved = localStorage.getItem('deafbakery_org_data');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].name && !parsed[0].name.includes('')) {
              setEmployees(parsed);
            } else {
              setEmployees(INITIAL_DATA);
            }
          } catch (e) {
            setEmployees(INITIAL_DATA);
          }
        } else {
          setEmployees(INITIAL_DATA);
        }
      }, []);

      const treeData = useMemo(() => buildTree(employees), [employees]);

      const handleLogin = (e) => {
        e.preventDefault();
        if (password === '25773388') {
          setIsAdmin(true);
          setShowLogin(false);
          setPassword("");
        } else {
          alert("密碼錯誤");
        }
      };

      const handleDelete = (id) => {
        if (window.confirm(`確定要刪除 ${id} 嗎？這可能會導致其下屬節點失去連結。`)) {
          const newData = employees.filter(e => e.id !== id);
          setEmployees(newData);
          localStorage.setItem('deafbakery_org_data', JSON.stringify(newData));
        }
      };

      const handleEdit = (employee) => {
        setEditingId(employee.id);
        setEditForm({ ...employee });
      };

      const handleSaveEdit = () => {
        const newData = employees.map(e => e.id === editingId ? editForm : e);
        setEmployees(newData);
        localStorage.setItem('deafbakery_org_data', JSON.stringify(newData));
        setEditingId(null);
      };

      const handleAdd = () => {
        const newId = `NEW_${Date.now()}`;
        const newEmp = { id: newId, name: "新成員", title: "", managementTitle: "", parentId: "" };
        const newData = [...employees, newEmp];
        setEmployees(newData);
        localStorage.setItem('deafbakery_org_data', JSON.stringify(newData));
        setEditingId(newId);
        setEditForm(newEmp);
      };

      const handleCopyCode = () => {
        const jsonString = JSON.stringify(employees, null, 2);
        // 這邊我們輸出的是給這個 HTML 版本用的資料
        const codeString = `const INITIAL_DATA = ${jsonString};`;
        navigator.clipboard.writeText(codeString);
        alert("程式碼已複製！請編輯此 HTML 檔案，找到 'const INITIAL_DATA = ...' 的部分並貼上取代，然後存檔即可永久更新。");
      };

      const handleZoomIn = () => setZoom(prev => Math.min(prev + 0.1, 2));
      const handleZoomOut = () => setZoom(prev => Math.max(prev - 0.1, 0.5));
      const handleResetZoom = () => setZoom(1);

      return (
        <div className="min-h-screen bg-orange-50 font-sans text-stone-800 flex flex-col h-screen">
          {/* 頂部導航 */}
          <nav className="bg-white shadow-sm border-b border-orange-100 z-50 flex-none">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center h-16">
                <div className="flex items-center gap-2">
                  <div className="bg-orange-500 text-white p-1.5 rounded-lg">
                    <Icon name="Users" size={20} />
                  </div>
                  <h1 className="text-xl font-bold tracking-tight text-stone-800">
                    Deafbakery <span className="text-orange-600 font-medium">組織圖</span>
                  </h1>
                </div>
                
                <button 
                  onClick={() => isAdmin ? setIsAdmin(false) : setShowLogin(true)}
                  className={`
                    flex items-center gap-2 px-4 py-2 rounded-full transition-all text-sm font-medium
                    ${isAdmin 
                      ? 'bg-stone-100 text-stone-600 hover:bg-stone-200' 
                      : 'bg-stone-800 text-white hover:bg-stone-900 shadow-md hover:shadow-lg'}
                  `}
                >
                  {isAdmin ? (
                    <React.Fragment><Icon name="LogOut" size={16} /> 退出編輯</React.Fragment>
                  ) : (
                    <React.Fragment><Icon name="LogIn" size={16} /> 登入編輯</React.Fragment>
                  )}
                </button>
              </div>
            </div>
          </nav>

          {/* 手機版：切換檢視模式 */}
          {!isAdmin && (
            <div className="lg:hidden flex border-b border-orange-100 bg-white sticky top-0 z-40">
              <button 
                onClick={() => setMobileViewMode('list')}
                className={`flex-1 py-3 text-sm font-medium flex justify-center items-center gap-2 border-b-2 transition-colors ${
                  mobileViewMode === 'list' 
                    ? 'border-orange-500 text-orange-600 bg-orange-50/50' 
                    : 'border-transparent text-stone-500'
                }`}
              >
                <Icon name="LayoutList" size={16} /> 列表清單
              </button>
              <button 
                onClick={() => setMobileViewMode('chart')}
                className={`flex-1 py-3 text-sm font-medium flex justify-center items-center gap-2 border-b-2 transition-colors ${
                  mobileViewMode === 'chart' 
                    ? 'border-orange-500 text-orange-600 bg-orange-50/50' 
                    : 'border-transparent text-stone-500'
                }`}
              >
                <Icon name="Network" size={16} /> 組織圖表
              </button>
            </div>
          )}

          <main className="flex-1 overflow-hidden relative">
            <div className="h-full w-full max-w-7xl mx-auto">
              {!isAdmin && (
                <React.Fragment>
                  {/* 圖表模式 */}
                  <div className={`
                    h-full w-full relative
                    ${(mobileViewMode === 'chart' || window.innerWidth >= 1024) ? 'block' : 'hidden lg:block'}
                  `}>
                    <div className="absolute bottom-6 right-6 z-30 flex flex-col gap-2 bg-white p-2 rounded-lg shadow-lg border border-stone-200">
                      <button onClick={handleZoomIn} className="p-2 hover:bg-stone-100 rounded text-stone-600" title="放大">
                        <Icon name="ZoomIn" size={20} />
                      </button>
                      <button onClick={handleZoomOut} className="p-2 hover:bg-stone-100 rounded text-stone-600" title="縮小">
                        <Icon name="ZoomOut" size={20} />
                      </button>
                      <button onClick={handleResetZoom} className="p-2 hover:bg-stone-100 rounded text-stone-600" title="重置大小">
                        <Icon name="Maximize" size={20} />
                      </button>
                      <div className="text-center text-xs text-stone-400 border-t pt-1 mt-1 font-mono">
                        {Math.round(zoom * 100)}%
                      </div>
                    </div>

                    <div className="h-full w-full overflow-auto bg-stone-50 cursor-grab active:cursor-grabbing p-10">
                       <div 
                         className="min-w-max min-h-max origin-top"
                         style={{ transform: `scale(${zoom})` }}
                       >
                          <div className="flex justify-center pb-20">
                            {treeData.map(node => <TreeNode key={node.id} node={node} />)}
                          </div>
                       </div>
                    </div>
                  </div>

                  {/* 手機列表模式 */}
                  <div className={`
                    h-full overflow-y-auto bg-white
                    ${mobileViewMode === 'list' ? 'block lg:hidden' : 'hidden'}
                  `}>
                     <div className="p-4 bg-orange-100 text-orange-800 text-sm font-medium border-b border-orange-200 sticky top-0 z-10">
                       點擊項目可展開/收合部門
                     </div>
                     {treeData.map(node => <MobileTreeNode key={node.id} node={node} />)}
                     <div className="p-8 text-center text-sm text-stone-400">
                        Designed for Deafbakery
                     </div>
                  </div>
                </React.Fragment>
              )}

              {/* 管理員編輯模式 */}
              {isAdmin && (
                <div className="h-full overflow-y-auto p-4">
                  <div className="bg-white rounded-xl shadow border border-stone-200 p-6 animate-fadeIn mb-8">
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                      <div>
                        <h2 className="text-2xl font-bold text-stone-800 flex items-center gap-2">
                          <Icon name="Edit" size={24} className="text-orange-500" /> 資料編輯模式
                        </h2>
                        <p className="text-stone-500 text-sm mt-1">在此處修改後，資料會暫存於瀏覽器。若要永久更新，請按複製程式碼，並貼回此 HTML 檔案中取代舊資料。</p>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={handleAdd} className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors shadow-sm">
                          <Icon name="Plus" size={18} /> 新增人員
                        </button>
                        <button onClick={handleCopyCode} className="flex items-center gap-2 bg-stone-800 hover:bg-stone-900 text-white px-4 py-2 rounded-lg transition-colors shadow-sm">
                          <Icon name="Copy" size={18} /> 複製程式碼
                        </button>
                      </div>
                    </div>

                    <div className="overflow-x-auto">
                      <table className="w-full text-left text-sm text-stone-600">
                        <thead className="bg-stone-50 text-stone-800 uppercase font-medium">
                          <tr>
                            <th className="p-3 rounded-tl-lg">ID</th>
                            <th className="p-3">姓名 (Name)</th>
                            <th className="p-3">技術職稱</th>
                            <th className="p-3">管理職稱</th>
                            <th className="p-3">Parent ID (上級)</th>
                            <th className="p-3 rounded-tr-lg text-right">操作</th>
                          </tr>
                        </thead>
                        <tbody className="divide-y divide-stone-100">
                          {employees.map(emp => (
                            <tr key={emp.id} className="hover:bg-orange-50 transition-colors">
                              {editingId === emp.id ? (
                                <React.Fragment>
                                  <td className="p-2"><input className="w-full p-1 border rounded" value={editForm.id} onChange={e => setEditForm({...editForm, id: e.target.value})} /></td>
                                  <td className="p-2"><input className="w-full p-1 border rounded" value={editForm.name} onChange={e => setEditForm({...editForm, name: e.target.value})} /></td>
                                  <td className="p-2"><input className="w-full p-1 border rounded" value={editForm.title} onChange={e => setEditForm({...editForm, title: e.target.value})} /></td>
                                  <td className="p-2"><input className="w-full p-1 border rounded" value={editForm.managementTitle} onChange={e => setEditForm({...editForm, managementTitle: e.target.value})} /></td>
                                  <td className="p-2"><input className="w-full p-1 border rounded" value={editForm.parentId} onChange={e => setEditForm({...editForm, parentId: e.target.value})} /></td>
                                  <td className="p-2 text-right">
                                    <button onClick={handleSaveEdit} className="text-green-600 hover:text-green-800 mr-2"><Icon name="Save" size={18}/></button>
                                    <button onClick={() => setEditingId(null)} className="text-stone-400 hover:text-stone-600">取消</button>
                                  </td>
                                </React.Fragment>
                              ) : (
                                <React.Fragment>
                                  <td className="p-3 font-mono text-xs">{emp.id}</td>
                                  <td className="p-3 font-bold text-stone-800">{emp.name}</td>
                                  <td className="p-3">{emp.title}</td>
                                  <td className="p-3 text-orange-600">{emp.managementTitle}</td>
                                  <td className="p-3 font-mono text-xs text-stone-400">{emp.parentId}</td>
                                  <td className="p-3 text-right">
                                    <button onClick={() => handleEdit(emp)} className="text-blue-500 hover:text-blue-700 mr-3"><Icon name="Edit" size={18}/></button>
                                    <button onClick={() => handleDelete(emp.id)} className="text-red-400 hover:text-red-600"><Icon name="Trash2" size={18}/></button>
                                  </td>
                                </React.Fragment>
                              )}
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </main>

          {/* 登入 Modal */}
          {showLogin && (
            <div className="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm animate-scaleIn">
                <h3 className="text-lg font-bold text-stone-800 mb-4">管理員登入</h3>
                <form onSubmit={handleLogin}>
                  <input 
                    type="password" 
                    placeholder="輸入密碼" 
                    className="w-full p-3 border border-stone-200 rounded-lg mb-4 focus:ring-2 focus:ring-orange-300 outline-none transition-all"
                    value={password}
                    onChange={e => setPassword(e.target.value)}
                    autoFocus
                  />
                  <div className="flex gap-2">
                    <button type="submit" className="flex-1 bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600 transition-colors">
                      登入
                    </button>
                    <button 
                      type="button" 
                      onClick={() => setShowLogin(false)}
                      className="flex-1 bg-stone-100 text-stone-600 py-2 rounded-lg hover:bg-stone-200 transition-colors"
                    >
                      取消
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
